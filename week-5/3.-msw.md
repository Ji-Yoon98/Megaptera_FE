# 3. MSW (Mock Service Worker)

{% hint style="info" %}
API Mocking ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ, ì„œë²„í–¥ì˜ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ê°€ë¡œì±„ì„œ ëª¨ì˜ ì‘ë‹µ(Mocked response)ì„ ë³´ë‚´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤.

MSW ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•˜ë©´, Mock ì„œë²„ë¥¼ êµ¬ì¶•í•˜ì§€ ì•Šì•„ë„ APIë¥¼ ë„¤íŠ¸ì›Œí¬ ìˆ˜ì¤€ì—ì„œ Mocking í•  ìˆ˜ ìˆê³ , ë„¤íŠ¸ì›Œí¬ Requestì— ëŒ€í•´ ìƒˆë¡œìš´ ë°©ì‹ìœ¼ë¡œ Mockingì´ ê°€ëŠ¥í•´ì§.

mocking - Mock(ëª¨ì˜ ë°ì´í„°)ë¥¼ ë§Œë“¤ì–´ í™œìš©í•˜ëŠ” ë°©ì‹
{% endhint %}

> [MSW](https://mswjs.io/)
> [Service Worker API](https://developer.mozilla.org/ko/docs/Web/API/Service_Worker_API)\
> [ì•„ìƒ¬ì˜ Mock Service Worker (MSW)](https://github.com/ahastudio/til/blob/main/mock-api/msw.md)\
> [Mocking REST API](https://mswjs.io/docs/getting-started/mocks/rest-api)\
> [Integrate mocking into Node](https://mswjs.io/docs/getting-started/integrate/node)

ì½”ë“œ ë ˆë²¨ì´ ì•„ë‹ˆë¼ ë„¤íŠ¸ì›Œí¬ ë ˆë²¨ì—ì„œ ê°€ì§œ êµ¬í˜„. ì˜¤í”„ë¼ì¸ ì‘ì—… ë“±ì„ ì§€ì›í•˜ê¸° ìœ„í•œ ì„œë¹„ìŠ¤ ì›Œì»¤ì˜ ê¸°ëŠ¥ì„ ìœ ìš©íˆ í™œìš©í•œ ê²ƒ.

```bash
// MSW íŒ¨í‚¤ì§€ ì„¤ì¹˜
npm i -D msw
```

```javascript
module.exports = {
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: [
    '@testing-library/jest-dom/extend-expect',
    '<rootDir>/src/setupTests.ts',  // ì´ ë¶€ë¶„
  ],
  transform: {
    '^.+\\.(t|j)sx?$': ['@swc/jest', {
      jsc: {
        parser: {
          syntax: 'typescript',
          jsx: true,
          decorators: true,
        },
        transform: {
          react: {
            runtime: 'automatic',
          },
        },
      },
    }],
  },
};
```

- ```jest.config.js```íŒŒì¼ì˜ â€œsetupFilesAfterEnvâ€ ì†ì„±ì— ```setupTests.ts``` íŒŒì¼ ì¶”ê°€.
</br>

```typescript
import server from './mocks/server';

beforeAll(() => server.listen({ onUnhandledRequest: 'error' }));

afterAll(() => server.close());

afterEach(() => server.resetHandlers())
```

- ```src/setupTests.ts```
</br>

```typescript
import { setupServer } from 'msw/node';

import handlers from './handlers';

const server = setupServer(...handlers);

export default server;
```

- ```src/mocks/server.ts```
</br>

```typescript
import { rest } from 'msw';

const BASE_URL = 'http://localhost:3000';

const handlers = [
  rest.get(`${BASE_URL}/products`, (req, res, ctx) => {
    // const {products} = fixtures;
    const products = [
      {
        category: 'Fruits', price: '$1', stocked: true, name: 'Apple',
      },
    ];

    return res(
      ctx.status(200),
      ctx.json({ products }),
      );
    }),
  ];

export default handlers;
```

- ```src/mocks/handlers.ts```
  â†’ Expressì˜ ê²½í—˜ì„ ì‚´ë ¤ë³´ì!
  </br>

```typescript
import { render, screen, waitFor } from '@testing-library/react';

import App from './App';

// jest.mock ë¶ˆí•„ìš”.

test('App', async () => {
  render(<App />);

  await waitFor(() => {
    screen.getByText('Apple');
  });
});
```

- ```App.test.ts```
</br>

ë„ˆë¬´ ë³¸ê²©ì ìœ¼ë¡œ ì½”ë”©í•˜ê²Œ ë˜ë©´ ë°±ì—”ë“œë¥¼ ê°œë°œí•˜ëŠ” ê²ƒ, ì´ ë¶€ë¶„ì— ì£¼ì˜

í…ŒìŠ¤íŠ¸ í™˜ê²½(Node.js ê¸°ë°˜) ì™¸ì— ì›¹ ë¸Œë¼ìš°ì €ë„ ì§€ì›í•˜ê¸° ë•Œë¬¸ì—,\
API ìŠ¤í™ì€ ë‚˜ì™”ì§€ë§Œ ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì€ ê²½ìš° ì„ì‹œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ.\
ë‹¨ìˆœíˆ ì„ì‹œ ì„œë²„ë¥¼ ë§Œë“¤ ê±°ë¼ë©´ Express ì“°ëŠ” ê²Œ ë” ë‚®ì§€ë§Œ,\
í…ŒìŠ¤íŠ¸ ì½”ë“œë„ ì§€ì›í•˜ë©´ì„œ ê²¸ì‚¬ê²¸ì‚¬ ì›¹ ë¸Œë¼ìš°ì €ë¥¼ ì§€ì›í•˜ëŠ” ìš©ë„ë¡œëŠ” ë‚˜ì˜ì§€ ì•Šì€ ì„ íƒ.

- [GitHubì—ì„œ ë§Œë“  fetch polyfill](https://github.com/github/fetch)

```bash
npm i -D whatwg-fetch
```

[ë§¨ ìœ„ë¡œğŸ”º](3.-msw.md#undefined)
