# 4. usestore-ts

### ğŸ“šë°”ë¡œê°€ê¸°

- [Actionì„ ë©”ì„œë“œë¡œ ì²˜ë¦¬í•˜ê¸°](4.-usestore-ts.md#action)
- [usestore-ts ì‚¬ìš©](4.-usestore-ts.md#usestore-ts)

## ğŸ“ Actionì„ ë©”ì„œë“œë¡œ ì²˜ë¦¬í•˜ê¸°

```typescript
type Listener = () => void;

export default class ObjectStore {
  private listeners = new Set<Listener>();

  addListener(listener: Listener) {
    this.listeners.add(listener);
  }

  removeListener(listener: Listener) {
    this.listeners.delete(listener);
  }

  protected publish() {
    this.listeners.forEach((listener) => listener());
  }
}
```

- ```src/stores/ObjectStore.ts``` íŒŒì¼
</br>

```typescript
import { singleton } from 'tsyringe'
import ObjectStore from './ObjectStore';

@singleton()
export default class CounterStore extends ObjectStore {
  count = 0;
  
  increase(step = 1) {
    this.count += step;
    this.publish();
  }

  decrease(step = 1) {
    this.count -= step;
    this.publish();
  }
}

```

- ```src/stores/CounterStore.ts``` íŒŒì¼
</br>

```typescript
import { useEffect } from 'react';
import useForceUpdate from './useForceUpdate';
import ObjectStore from '../stores/ObjectStore';

export default function useObjectStore<T extends ObjectStore>(store: T) : T {
  const forceUpdate = useForceUpdate();
  
  useEffect(() => {
    store.addListener(forceUpdate);
  
    return () => store.removeListener(forceUpdate);
  }, [store, forceUpdate]);

  return store;
}
```

- ```src/hooks/useObjectStore.ts``` íŒŒì¼
</br>

```typescript
import { container } from 'tsyringe';
import CounterStore from '../stores/CounterStore';
import useObjectStore from './useObjectStore';

export default function useCounterStore() {
  const store = container.resolve(CounterStore);

  return useObjectStore(store);
}
```

- ```src/hooks/useCounterStore.ts``` íŒŒì¼
</br>

[ëª©ì°¨ğŸ”º](4.-usestore-ts.md#undefined)

## ğŸ“ usestore-ts ì‚¬ìš©

> [usestore-ts](https://usestore-ts.com/)

```typescript
// Store ì‘ì„±.
import { singleton } from 'tsyringe';
import { Store, Action } from 'usestore-ts';

@singleton()
@Store()
export default class CounterStore {
  count = 0;

  @Action()
  increase(step = 1) {
    this.count += step;
  }

  @Action()
  decrease(step = 1) {
    this.count -= step;
  }
}

// ì»¤ìŠ¤í…€ Hook ì‘ì„±.
import { container } from 'tsyringe';
import { useStore } from 'usestore-ts';
import CounterStore from '../stores/CounterStore';

export default function useCounterStore() {
  const store = container.resolve(CounterStore);
  return useStore(store);
}
```

</br>

```typescript
@singleton()
@Store()
class PostStore {
  posts: Post[] = [];

  async fetchPosts() {
    this.startLoading();

    const posts = await fetchPosts(); 

    this.completeLoading(posts);
  }

  @Action()
  startLoading() {
    this.posts = [];
  }

  @Action()
  completeLoading(posts: Post[]) {
    this.posts = posts;
  }
}
```

- ë¹„ë™ê¸° í•¨ìˆ˜ì— <mark style="color:red;">**@Action**</mark>ì„ ë¶™ì´ë©´ ë‹¤ë¥´ê²Œ ì‘ë™í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì— ì£¼ì˜!\
  ë³„ë„ì˜ ì•¡ì…˜ì„ ë§Œë“¤ë©´ ì‹ ê²½ ì“¸ ë¶€ë¶„ì´ ì¤„ì–´ë“ ë‹¤.

</br>

- ì°¸ê³ ìë£Œ ğŸ‘‡ğŸ»
- [useSyncExternalStore](https://beta.reactjs.org/reference/react/useSyncExternalStore)
- [FECONF 2022 - ìƒíƒœê´€ë¦¬ ì´ ì „ìŸì„ ëë‚´ëŸ¬ ì™”ë‹¤](https://youtu.be/KEDUqA9JeIo)

[ëª©ì°¨ğŸ”º](4.-usestore-ts.md#undefined)
