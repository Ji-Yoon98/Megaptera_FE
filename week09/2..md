# 2. ëª©ë¡ ë³´ê¸°

## ğŸ“ìƒí’ˆ ëª©ë¡

ìƒí’ˆ ëª©ë¡ì„ ì–»ì–´ì„œ í‘œì‹œí•˜ëŠ” í™”ë©´ì„ ë§Œë“¤ì–´ë³´ì.\
ë§ ê·¸ëŒ€ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ë‘ ê°€ì§€ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆìŒ :

1. ìƒí’ˆ ëª©ë¡ ì–»ê¸°
2. ìƒí’ˆ ëª©ë¡ ë³´ì—¬ì£¼ê¸°

ì „ìëŠ” useFetchProducts í›…ìœ¼ë¡œ, í›„ìëŠ” Products ì»´í¬ë„ŒíŠ¸ë¡œ êµ¬í˜„í•˜ê³ ,\
ProductListPageì—ì„  ì´ ë‘˜ì„ ì¡°í•©í•œë‹¤.

```typescript
import Products from '../components/product-list/Products';

import useFetchProducts from '../hooks/useFetchProducts';

export default function ProductListPage() {
  const { products } = useFetchProducts();

  return (
    <div>
      <h2>Products</h2>
      <Products products={products} />
    </div>
  );
}
```

</br>
ìƒí’ˆëª©ë¡ ì§„í–‰ ìˆœì„œ

  1. useFetchProductsí›…ì„ ê°„ë‹¨íˆ êµ¬í˜„
  2. Products ì»´í¬ë„ŒíŠ¸
  3. Product  ì»´í¬ë„ŒíŠ¸
  4. numberFormat ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì¤€ë¹„(ìˆ«ì˜ ì½ê¸° ì¢‹ê²Œ ë³´ì—¬ì¤Œ) ğŸ‘‡ğŸ»

  ```typescript
  export default function numberFormat(value: number) {
    return new Intl.NumberFormat().format(value);
  }
  ```

  5. ìƒí’ˆ ëª©ë¡ì„ Storeë¡œ ê´€ë¦¬ ğŸ‘‡ğŸ»

  ```typescript
  @singleton()
  @Store()
  export default class ProductsStore {
    products: ProductSummary[] = [];

    async fetchProducts() {
      this.setProducts([]);

      const { data } = await axios.get(`${apiBaseUrl}/products`);
      const { products } = data;

      this.setProducts(products);
    }

    @Action()
    setProducts(products: ProductSummary[]) {
      this.products = products;
    }
  }
  ```

  6. useFetchProducts í›… ë³€ê²½ ğŸ‘‡ğŸ»

  ```typescript
  export default function useFetchProducts(): {
    products: ProductSummary[];
  } {
    const store = container.resolve(ProductsStore);

    const [{ products }] = useStore(store);

    useEffectOnce(() => {
      store.fetchProducts();
    }); 

    return { products };
  }
  ```

## ğŸ“ì¹´í…Œê³ ë¦¬ ëª©ë¡

ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì§„í–‰ ìˆœì„œ

  1. í—¤ë”ì— ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë³´ì—¬ì£¼ê¸°
  2. Store ì¤€ë¹„
  3. API í˜¸ì¶œì„ ëª¨ì•„ì£¼ëŠ” ApiServiceë¥¼ ë§Œë“¬ ğŸ‘‡ğŸ»

  APIì˜ base URLì„ ì§€ì •í•˜ê¸° ìœ„í•´ í™˜ê²½ë³€ìˆ˜ë¥¼ í™œìš©.

  ```typescript
  const API_BASE_URL = process.env.API_BASE_URL || 'https://shop-demo-api-01.fly.dev';

  export default class ApiService {
    private instance = axios.create({
      baseURL: API_BASE_URL,
    });

    async fetchCategories(): Promise<Category[]> {
      const { data } = await this.instance.get('/categories');
      const { categories } = data;
      return categories;
    }

    async fetchProducts(): Promise<ProductSummary[]> {
      const { data } = await this.instance.get('/products');
      const { products } = data;
      return products;
    }
  }

  export const apiService = new ApiService();
  ```

  4. useFetchCategories í›…ì„ ë§Œë“¬

## ğŸ“ì¹´í…Œê³ ë¦¬ë³„ ìƒí’ˆ ëª©ë¡

ProductListPage ì»´í¬ë„ŒíŠ¸ì—ì„œ categoryIdë¥¼ ì–»ëŠ”ë‹¤.

```typescript
export default function ProductListPage() {
  const [params] = useSearchParams();

  const categoryId = params.get('categoryId') ?? undefined;

  const { products } = useFetchProducts({ categoryId });

  return (
    <div>
      <h2>Products</h2>
      <Products products={products} />
    </div>
  );
}
```

</br>
ì¹´í…Œê³ ë¦¬ IDë¥¼ ì“°ë„ë¡ í›… ë³€ê²½

```typescript
export default function useFetchProducts({ categoryId }: {
  categoryId: string;
}): {
  products: ProductSummary[];
} {
  const store = container.resolve(ProductsStore);

  const [{ products }] = useStore(store);

  useEffect(() => {
    store.fetchProducts({ categoryId });
  }, [store, categoryId]);

  return { products };
}
```

Store, API Serviceë„ ë³€ê²½.

```typescript
// Store
async fetchProducts({ categoryId }: {
  categoryId?: string;
}) {
  this.setProducts([]);

  const products = await apiService.fetchProducts({ categoryId });

  this.setProducts(products);
}

// API Service
async fetchProducts({ categoryId }: {
  categoryId?: string;
} = {}): Promise<ProductSummary[]> {
  const { data } = await this.instance.get('/products', {
    params: { categoryId },
  });
  const { products } = data;
  return products;
}
```

- ì²˜ìŒë¶€í„° ê³ ë¯¼í•´ì„œ ë°”ë¡œ ë§Œë“¤ì–´ë„ ë˜ê³ , ë‚˜ì¤‘ì— ê³ ì³ë„ ìƒê´€ì—†ìŒ.
- í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ìˆìœ¼ë©´ ë³€ê²½ ì‘ì—…ì„ í•  ë•Œ ë” ìì‹ ê°ì„ ì–»ì„ ìˆ˜ ìˆìŒ.
